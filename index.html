<!DOCTYPE html>
<html>
  <head>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.4/css/bulma.min.css" />
  </head>
  <body>
    <section class="hero is-primary is-bold">
      <div class="hero-body">
        <div class="container">
          <h1 class="title">Data Entry Form</h1>
        </div>
      </div>
    </section>
    <form id="form" class="container m-4 pl-4">
      <div class="field">
        <label class="label">Client Name</label>
        <div class="control">
          <input class="input" type="text" placeholder="Your Client Name" name="Client Name" required />
        </div>
      </div>
      <div class="field">
        <label class="label">Email</label>
        <div class="control">
          <input class="input" type="email" placeholder="Your Email" name="Email" required />
        </div>
      </div>
      <div class="field is-grouped">
        <div class="control">
          <button class="button is-primary" type="submit">Submit</button>
        </div>
      </div>
    </form>
    <div id="message" style="margin: 20px; font-weight: bold; display: none;"></div>
    <section class="container mt-4">
      <h2 class="title">Submitted Data</h2>
      <table class="table is-fullwidth is-striped">
        <thead id="table-head"></thead>
        <tbody id="table-body"></tbody>
      </table>
    </section>
    <script>
      const form = document.getElementById("form");
      const message = document.getElementById("message");
      const tableHead = document.getElementById("table-head");
      const tableBody = document.getElementById("table-body");
      
      // Fetch data from the Google Sheet and populate the table
      async function fetchSheetData() {
        try {
          const response = await fetch("https://script.google.com/macros/s/AKfycbzKjehavT6TXMBhvjQUHeC5Ys04cH1wnuf96dsPk0vqSLbMumlHU2IX0JqgRXngyFdW/exec");
          const data = await response.json();
          populateTable(data);
        } catch (error) {
          console.error("Error fetching data:", error);
        }
      }

      // Populate the table with data
      function populateTable(data) {
        if (data.length === 0) return;

        // Clear existing table data
        tableHead.innerHTML = "";
        tableBody.innerHTML = "";

        // Set table headers
        const headers = Object.keys(data[0]);
        const headerRow = document.createElement("tr");
        headers.forEach(header => {
          const th = document.createElement("th");
          th.textContent = header;
          headerRow.appendChild(th);
        });
        tableHead.appendChild(headerRow);

        // Set table rows
        data.forEach(row => {
          const tr = document.createElement("tr");
          headers.forEach(header => {
            const td = document.createElement("td");
            td.textContent = row[header] || "";
            tr.appendChild(td);
          });
          tableBody.appendChild(tr);
        });
      }

      // Submit the form data
      form.addEventListener("submit", async e => {
        e.preventDefault();
        const formData = new FormData(form);
        const formParams = new URLSearchParams(formData).toString();

        message.style.display = "block";
        message.textContent = "Submitting...";

        try {
          const response = await fetch("YOUR_WEB_APP_URL_HERE", {
            method: "POST",
            body: formParams,
            headers: { "Content-Type": "application/x-www-form-urlencoded" }
          });
          if (!response.ok) throw new Error("Failed to submit data.");
          message.textContent = "Data submitted successfully!";
          form.reset();
          fetchSheetData(); // Refresh the table with updated data
        } catch (error) {
          console.error("Error submitting data:", error);
          message.textContent = "Error submitting data.";
        } finally {
          setTimeout(() => {
            message.style.display = "none";
          }, 3000);
        }
      });

      // Fetch and display the data on page load
      fetchSheetData();
    </script>
  </body>
</html>
